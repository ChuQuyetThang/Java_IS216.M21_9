--DATABASE QUAN LY CUA HANG DIEN THOAI DI DONG

-- TAO BANG NHAN VIEN
CREATE TABLE NHANVIEN(
    MaNV CHAR(5) NOT NULL PRIMARY KEY,
    HoTen VARCHAR2(30),
    GioiTinh VARCHAR2(10),
    CMND VARCHAR2(20),
    DiaChi VARCHAR2(200),
    Email VARCHAR2(100),
    SDT VARCHAR2(10),
    SoNgayLam NUMBER,
    MaPB CHAR(5)
);

--TAO BANG PHONGBAN
CREATE TABLE PHONGBAN(
    MaPB CHAR(5) NOT NULL PRIMARY KEY,
    TenPB VARCHAR2(30),
    SoLuongNV NUMBER,
    TruongPB CHAR(5)
);

--TAO BANG SANPHAM
CREATE TABLE SANPHAM(
    MaSP CHAR(5) NOT NULL PRIMARY KEY,
    MaKM CHAR(5),
    MaNCC CHAR(5),
    TenSP VARCHAR2(30),
    MauSac VARCHAR2(10),
    DonGia NUMBER,
    SoLuong NUMBER
);

--TAO BANG KHUYENMAI
CREATE TABLE KHUYENMAI(
    MaKM CHAR(5) NOT NULL PRIMARY KEY,
    TenKM VARCHAR2(25),
    NgayBD DATE,
    NgayKT DATE,
    PhanTramKM NUMBER
);

--TAO BANG NHACUNGCAP 
CREATE TABLE NHACUNGCAP(
    MaNCC CHAR(5) NOT NULL PRIMARY KEY,
    TenNCC VARCHAR2(100),
    DiaChi VARCHAR2(100),
    Email VARCHAR2(50),
    SDT VARCHAR2(10)
);

--TAO BANG KHACHHANG
CREATE TABLE KHACHHANG(
    MaKH CHAR(5) NOT NULL PRIMARY KEY,
    TenKH VARCHAR2(30),
    DiaChi VARCHAR2(100),
    CMND VARCHAR2(12),
    Email VARCHAR2(50),
    SDT VARCHAR2(10)
);

--TAO BANG HD_BANSP
CREATE TABLE HD_BANSP(
    SoHD CHAR(5) NOT NULL PRIMARY KEY,
     MaKH CHAR(5),
    MaPBH CHAR(5),
    MaNV CHAR(5),
    NgayLapHD DATE,
    TriGia NUMBER
);

--TAO BANG CHI TIET HOA DON
CREATE TABLE CTHD_BANSP(
    SoHD CHAR(5),
    MaSP CHAR(5),
    SoLuongMua NUMBER,
    CONSTRAINT PK_CTHD PRIMARY KEY (SOHD,MASP)
);

--TAO BANG PHIEUBAOHANH 
CREATE TABLE PHIEUBAOHANH(
    MaPBH CHAR(5) NOT NULL PRIMARY KEY,
    NgayBatDau DATE,
    NgayHetHan DATE
);

--TAO BANG BAOHANHSP
CREATE TABLE BAOHANHSP(
    MaBH CHAR(5) NOT NULL PRIMARY KEY,
    MaSP CHAR(5),
    NgayBH DATE,
    ChiPhiBH NUMBER,
    MoTaLoi VARCHAR2(100)
);

--TAO BANG DANGNHAP
CREATE TABLE DANGNHAP(
    TenDN VARCHAR2(20) NOT NULL PRIMARY KEY,
    CapBac VARCHAR2(20),
    MatKhau VARCHAR2(20),
    MaNV CHAR(5)
);


-------------TAO KHOA NGOAI
ALTER TABLE NHANVIEN ADD CONSTRAINT FK_NVPB FOREIGN KEY (MaPB) REFERENCES PHONGBAN(MaPB);
ALTER TABLE DANGNHAP ADD CONSTRAINT FK_NVDN FOREIGN KEY (MaNV) REFERENCES NHANVIEN(MaNV);
ALTER TABLE SANPHAM ADD CONSTRAINT FK_SPNCC FOREIGN KEY (MANCC) REFERENCES NHACUNGCAP(MANCC);
ALTER TABLE SANPHAM ADD CONSTRAINT FK_SPKM FOREIGN KEY (MAKM) REFERENCES KHUYENMAI(MAKM);
ALTER TABLE BAOHANHSP ADD CONSTRAINT FK_BHSP FOREIGN KEY (MASP) REFERENCES SANPHAM(MASP);
ALTER TABLE CTHD_BANSP  ADD CONSTRAINT FK_CTHD FOREIGN KEY (MASP) REFERENCES SANPHAM(MASP);
ALTER TABLE CTHD_BANSP  ADD CONSTRAINT FK_CTHD_HD FOREIGN KEY (SOHD) REFERENCES HD_BANSP(SOHD);
ALTER TABLE HD_BANSP  ADD CONSTRAINT FK_HD_PBH FOREIGN KEY (MAPBH) REFERENCES PHIEUBAOHANH(MAPBH);
ALTER TABLE HD_BANSP  ADD CONSTRAINT FK_HD_KH FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH);
ALTER TABLE HD_BANSP  ADD CONSTRAINT FK_HD_NV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV);


-------------IMPORT DATA 
-- NHA CUNG CAP
INSERT INTO NHACUNGCAP VALUES ('NCC01', 'Thang Long sl', 'Võ Nguyên Giáp, dông Anh, Hà N?i', 'ncc1@gmail.com','0125436172');
INSERT INTO NHACUNGCAP VALUES ('NCC02', 'Vi?n Thông Long Hung', '73-75-77-79 Nguy?n ?ình Chi?u, P. 1, B?n Tre', 'VTLH@gmail.com','0245361721');
INSERT INTO NHACUNGCAP VALUES ('NCC03', 'TMDV Ki?n Qu?c', '???ng 26/3, P. châu V?n Liêm, Q. Ô Môn, TP. C?n Th?', 'ncc03@gmail.com','0925436172');
INSERT INTO NHACUNGCAP VALUES ('NCC04', 'Th? Gi?i DD','217A Qu?c L? 15, P. Tây Ti?n, Tp. Biên Hòa, ??ng Nai', 'dongnao@gmail.com','0251629063');
INSERT INTO NHACUNGCAP VALUES ('NCC05', 'Cn Biên Hòa', '851 Quang Trung, Nghia Chánh, TP. Qu?ng Ngãi, Qu?ng Ngãi', 'quangngai@gmail.com','0435436172');
INSERT INTO NHACUNGCAP VALUES ('NCC06', 'Vi?n Thông ??c Huy', '187A ???ng 3/2, P. 11, Q. 10, Tp. H? Chí Minh (TPHCM)', 'VTDH@gmail.com','0935436172');
INSERT INTO NHACUNGCAP VALUES ('NCC07', 'Thành Trung Mobile', '1401 ???ng 3 Tháng 2, Qu?n 1, Tp. H? Chí Minh TPHCM', 'TTMB@gmail.com','0987936069');
INSERT INTO NHACUNGCAP VALUES ('NCC08', 'CNTT Hoàn V?', '265 Hoàng Hoa Thám , P. 13 , Q. Tân Bình. Tp. Hô Chí Minh', 'HHT@gmail.com','0976060324');
INSERT INTO NHACUNGCAP VALUES ('NCC09', 'Công Ty C? Ph?n Kì Ngh? Và Th??ng Mai Nh?t Minh', 'S? 26, T? 7, P. ??c Giang, Q Long Biên, Hà N?i', 'MNM@gmail.com','0966222288');
INSERT INTO NHACUNGCAP VALUES ('NCC10', 'Công Ty TNHH Di ??ng Ti?n Thành', '223 Ngô Gia T?, Tp. Phan Rang, Tháp Chàm Ninh Thu?n', 'ddTT@gmail.com','0909440299');

--KHUYENMAI
INSERT INTO KHUYENMAI VALUES('KM001',	'Chào Sea Game',TO_DATE('1/5/2022', 'dd/mm/yyyy'),	TO_DATE('30/5/2022', 'dd/mm/yyyy'),	50);
INSERT INTO KHUYENMAI VALUES('KM002',	'??i l? Lenovo',TO_DATE('1/3/2022', 'dd/mm/yyyy'),	TO_DATE('10/3/2022', 'dd/mm/yyyy'),	20);
INSERT INTO KHUYENMAI VALUES('KM003',	'Qu?c t? thi?u nhi',TO_DATE('1/6/2022', 'dd/mm/yyyy'),	TO_DATE('10/6/2022', 'dd/mm/yyyy'),	15);
INSERT INTO KHUYENMAI VALUES('KM004',	'X? kho',TO_DATE('14/10/2022', 'dd/mm/yyyy'),	TO_DATE('30/11/2022', 'dd/mm/yyyy'),	20);
INSERT INTO KHUYENMAI VALUES('KM005',	'S?n ph?m m?ii',TO_DATE('21/4/2022', 'dd/mm/yyyy'),	TO_DATE('3/5/2022', 'dd/mm/yyyy'),	30);
INSERT INTO KHUYENMAI VALUES('KM006',	'Ngày l?',TO_DATE('1/1/2022', 'dd/mm/yyyy'),	TO_DATE('2/2/2022', 'dd/mm/yyyy'),	15);
INSERT INTO KHUYENMAI VALUES('KM007',	'L? t?t',TO_DATE('1/1/2022', 'dd/mm/yyyy'),	TO_DATE('1/9/2022', 'dd/mm/yyyy'),	20);
INSERT INTO KHUYENMAI VALUES('KM008',	'Siêu khuuy?n mãi',TO_DATE('1/2/2022', 'dd/mm/yyyy'),	TO_DATE('3/5/2022', 'dd/mm/yyyy'),	15);

--SANPHAM
INSERT INTO SANPHAM VALUES('SP001','KM001','NCC10',	'REDMINOTE 4',	'XANH',	2500000,5);
INSERT INTO SANPHAM VALUES('SP002','KM008','NCC01',	'REDMINOTE 7',	'DO',	3400000,6);
INSERT INTO SANPHAM VALUES('SP003','KM007','NCC02',	'REDMINOTE 11',	'VANG',	3500000,7);
INSERT INTO SANPHAM VALUES('SP004','KM006','NCC03',	'REDMINOTE11 pro',	'HONG',	6500000,5);
INSERT INTO SANPHAM VALUES('SP005','KM005','NCC04',	'REMINOTE 11 5G',	'NAU',	4000000,4);
INSERT INTO SANPHAM VALUES('SP006','KM004','NCC05',	'XIAOMI MI 11',	'GOLD',	3400000,3);
INSERT INTO SANPHAM VALUES('SP007','KM003','NCC06',	'XIAOMI MI 10S',	'DA MAU',	9700000,2);
INSERT INTO SANPHAM VALUES('SP008','KM004','NCC07',	'XIAOMI MI 10',	'DEN',	10300000,1);
INSERT INTO SANPHAM VALUES('SP009','KM005','NCC08',	'REDMI K50',	'TRANG',	7390000,6);
INSERT INTO SANPHAM VALUES('SP010','KM006','NCC09',	'REDMI K40S',	'TRANG',	9450000,3);
INSERT INTO SANPHAM VALUES('SP011','KM007','NCC01',	'REDMI K40 PRO',	'XANH',	10000000,2);
INSERT INTO SANPHAM VALUES('SP012','KM008','NCC02',	'BLACK SHARK 4',	'VANG',	7000000,2);
INSERT INTO SANPHAM VALUES('SP013','KM007','NCC10',	'SAMSUNG S22 UNTRAL',	'HONG',	6550000,5);
INSERT INTO SANPHAM VALUES('SP014','KM007','NCC08',	'REDMAGIC 6',	'TIM',	18000000,7);
INSERT INTO SANPHAM VALUES('SP015','KM001','NCC06',	'REDMAGIC 6S',	'DO',	7400000,12);
INSERT INTO SANPHAM VALUES('SP016','KM002','NCC07',	'REDMAGIC 7',	'DEN',	2500000,5);
INSERT INTO SANPHAM VALUES('SP017','KM004','NCC06',	'REDMAGIC 7 PRO',	'TRANG',	10000000,5);
INSERT INTO SANPHAM VALUES('SP018','KM003','NCC08',	'SAMSUNG S10 PLUS',	'DEN',	12000000,2);
INSERT INTO SANPHAM VALUES('SP019','KM003','NCC08',	'OPPO A33',	'VANG',	15000000,6);
INSERT INTO SANPHAM VALUES('SP020','KM004','NCC03',	'OPPO A37',	'HONG',	8000000,2);
INSERT INTO SANPHAM VALUES('SP021','KM005','NCC02',	'OPPO A37',	'XANH',	1218000,2);
INSERT INTO SANPHAM VALUES('SP022','KM007','NCC06',	'OPPO A53',	'XANH',	1234000,5);
INSERT INTO SANPHAM VALUES('SP023','KM006','NCC01',	'OPPO Find X3 Pro 5G',	'XANH',	4490000,4);
INSERT INTO SANPHAM VALUES('SP024','KM008','NCC08',	'OPPO A95',	'XANH',	10490000,2);
INSERT INTO SANPHAM VALUES('SP025','KM001','NCC08',	'Tai nghe Bluetooth OPPO Air 2',	'DEN',	3490000,5);
INSERT INTO SANPHAM VALUES('SP026','KM002','NCC09',	'Pin sac du phòng OPPO PBV02',	'DEN',	2500000,4);
INSERT INTO SANPHAM VALUES('SP027','KM003','NCC10',	'Op lung Oppo Reno7',	'HONG',	6990000,2);
INSERT INTO SANPHAM VALUES('SP028','KM002','NCC10',	'Op lung OPPO A74',	'XANH',	5990000,5);
INSERT INTO SANPHAM VALUES('SP029','KM007','NCC10',	'Tai nghe XIAOMIPOT',	'CAM',	1800000,7);
INSERT INTO SANPHAM VALUES('SP030','KM004','NCC10',	'Loa SAMSUNGPOT',	'TIM',	3490000,5);
INSERT INTO SANPHAM VALUES('SP031','KM005','NCC06',	'Op ung OPPO A54',	'VANG',	2500000,7);
INSERT INTO SANPHAM VALUES('SP032','KM001','NCC02',	'Pin sac du phòng OPPO PBV02',	'TRANG',	3000000,7);
INSERT INTO SANPHAM VALUES('SP033','KM002','NCC10',	'Tai nghe OPPOPOT',	'DEN',	1800000,8);
INSERT INTO SANPHAM VALUES('SP034','KM004','NCC02',	'REDMINOTE',	'GOLD',	190000,9);
INSERT INTO SANPHAM VALUES('SP035','KM003','NCC10',	'Tai nghe Co Day OPPO MH135-3',	'DA SAC',	1800000,6);
INSERT INTO SANPHAM VALUES('SP036','KM004','NCC06',	'Adapter Sac OPPO VCA7JAUH ',	'XANH',	190000,6);
INSERT INTO SANPHAM VALUES('SP037','KM001','NCC02',	'Tai nghe AIRPOT',	'HONG',	100000,7);
INSERT INTO SANPHAM VALUES('SP038','KM003','NCC04',	'IPHONE XS MAX',	'XANH',	2500000,7);
INSERT INTO SANPHAM VALUES('SP039','KM007','NCC04',	'IPHONE 13 pro',	'TIM',	22000000,8);
INSERT INTO SANPHAM VALUES('SP040','KM007','NCC10',	'IPHONE 13 promax',	'DEN',	29000000,5);

--BAOHANH SP
INSERT INTO BAOHANHSP VALUES('BH001','SP020',TO_DATE('12/5/2022', 'dd/mm/yyyy'),	1500000, 'CHAY MAN HINH');
INSERT INTO BAOHANHSP VALUES('BH002','SP032',TO_DATE('20/1/2022', 'dd/mm/yyyy'),	250000, 'HONG CAP SAC');
INSERT INTO BAOHANHSP VALUES('BH003','SP022',TO_DATE('11/4/2022', 'dd/mm/yyyy'),	3500000, 'CHAI PIN');
INSERT INTO BAOHANHSP VALUES('BH004','SP005',TO_DATE('15/2/2022', 'dd/mm/yyyy'),	1700000, 'THAY  MAN HINH');
INSERT INTO BAOHANHSP VALUES('BH005','SP011',TO_DATE('23/2/2022', 'dd/mm/yyyy'),	500000, 'THAY  OP LUNG');

--PHONGBAN
INSERT INTO PHONGBAN VALUES('PB001','PHONG KY THUAT',3,'NV009');
INSERT INTO PHONGBAN VALUES('PB002','PHONG TAI CHINH',4,'NV015');
INSERT INTO PHONGBAN VALUES('PB003','PHONG TIEP TAN',3,'NV024');
INSERT INTO PHONGBAN VALUES('PB004','PHONG DEVELOPE',4,'NV030');
INSERT INTO PHONGBAN VALUES('PB005','PHONG MARKETING',4,'NV025');
INSERT INTO PHONGBAN VALUES('PB006','PHONG BAO VE',2,'NV006');
INSERT INTO PHONGBAN VALUES('PB007','PHONG TU VAN',3,'NV028');
INSERT INTO PHONGBAN VALUES('PB008','PHONG VE SINH',3,'NV003');
INSERT INTO PHONGBAN VALUES('PB009','PHONG QUAN LY',5,'NV002');
INSERT INTO PHONGBAN VALUES('PB010','PHONG NHAN VIEN BAN HANG',4,'NV017');

--KHACHHANG
INSERT INTO KHACHHANG VALUES('KH001','Bùi Bá H?ng','B16 Song hành An phú  An Khánh Q.02 TPHCM','231718755','BBH@GMAIL.COM','0909522702');
INSERT INTO KHACHHANG VALUES('KH002','Bùi Duy Kh??ng','408 A2 C.c An Phú','241717755','bdk@GMAIL.COM','0172623718');
INSERT INTO KHACHHANG VALUES('KH003','Bùi Hoàng L? Di?m','503 Cao ô?c  An Phú P.An Phú Q.2 TPHCM','261718755','BHLD@GMAIL.COM','0918793284');
INSERT INTO KHACHHANG VALUES('KH004','Bùi Kim Anh','84 ???ng 1 khu B , An Phú Q.02 TPHCM','131718755','BKA@GMAIL.COM','0903734355');
INSERT INTO KHACHHANG VALUES('KH005','Bùi Lê Thùy Trâm','l?u 8 , phòng 801, Cao ?c An Khánh, Khu A P.AN KHANH Q.2 TPHCM','121718755','BLTV@GMAIL.COM','0989991211');
INSERT INTO KHACHHANG VALUES('KH006','Bùi Ng?c Minh','128 ???ng 17B p. An Phú Q.02 TPHCM','142718755','BNM@GMAIL.COM','0907225050');
INSERT INTO KHACHHANG VALUES('KH007','Bùi Quang C?n','307 cao ?c an khánh song hành t? 42, An Phú Q.02 TPHCM','191718755','BQC@GMAIL.COM','0903683668');
INSERT INTO KHACHHANG VALUES('KH008','Bùi Thanh Tùng','57 ???ng 17A khu B an phú an khánh P.An Phú Q.02 TPHCM','121718755','BTT@GMAIL.COM','0866718337');
INSERT INTO KHACHHANG VALUES('KH009','Bùi Thu Nga','F106 cc 5 t?ng ???ng 8 B Khu an phú P.An Khánh Q.02 TPHCM','291718755','BTN@GMAIL.COM','0913741210');
INSERT INTO KHACHHANG VALUES('KH010','Bùi Th? Mai H??ng','1080 ???ng 10B p. An Phú Q.02 TPHCM','111718755','BTMH@GMAIL.COM','0905611688');
INSERT INTO KHACHHANG VALUES('KH011','Bùi T?n Trung','178 ???ng 18 khu B kdtm an ph1u an khánh p.An Phú Q.02 TPHCM','121718755','BTT@GMAIL.COM','983277149');
INSERT INTO KHACHHANG VALUES('KH012','Bùi V?n M?a','683 ???ng s? 80 khu A ?ô th? m?i AP-AK An Phú Q.02 TPHCM','290718755','BVM@GMAIL.COM','0903695782');
INSERT INTO KHACHHANG VALUES('KH013','Bùi V?nh Phúc','12 ???ng 8 (c? 7?1), p.An Phú Q.02 TPHCM','231767755','BVP@GMAIL.COM','0903631264');
INSERT INTO KHACHHANG VALUES('KH014','Bùi Xuân H?ng','p.701 cao ?c an khánh p. An Phú Q.02 TPHCM','241718755','BXH@GMAIL.COM','0903912540');
INSERT INTO KHACHHANG VALUES('KH015','L??ng Anh Ph?ng','Long Tr?, Long M?, H?u Giang','181718755','LAP@GMAIL.COM','0989209286');
INSERT INTO KHACHHANG VALUES('KH016','??ng Hu?nh Thành Nhân','300/43 Nguy?n V?n Linh, Ph??ng Bình Thu?n, Qu?n 7','211718755','BHTN@GMAIL.COM','0972623718');
INSERT INTO KHACHHANG VALUES('KH017','Hoàng Trung Chính','41/27 H??ng L? 14, H/Tân, Q.TP','331718755','HTC@GMAIL.COM','0932623718');
INSERT INTO KHACHHANG VALUES('KH018','??ng Hu?nh Thành Nhân','33/5, Tr?n Bình Tr?ng, P1, Q5','118718755','DHTN@GMAIL.COM','0892623718');
INSERT INTO KHACHHANG VALUES('KH019','??ng Ng?c H?ng','2/41 Cao Th?ng P5, Q3','231718755','DNH@GMAIL.COM','0622623718');
INSERT INTO KHACHHANG VALUES('KH020','?inh Th? Hoài Ph??ng','276 Phan V?n Tr?, Q.Bình Th?nh','231718755','ABC@GMAIL.COM','0182623718');
INSERT INTO KHACHHANG VALUES('KH021','?? Minh Tu?n','57/65 Tr?n Bình Tr?ng, P1, Q5','2123118755','ATD@GMAIL.COM','0352623718');
INSERT INTO KHACHHANG VALUES('KH022','Lê ??c D?ng','31 Tr?n Chánh Chi?u, P14, Q5','192718755','DVV@GMAIL.COM','0532623718');
INSERT INTO KHACHHANG VALUES('KH023','H? Th? Thanh Nguyên','246/28 Phan Huy Ích, P12, Q Gò V?p','2312118755','ABC@GMAIL.COM','0212623718');
INSERT INTO KHACHHANG VALUES('KH024','Tr?n H?ng Tu?n','1A73 ?p 1 Ph?m V?n Hai, H Bình Chánh','111118755','AACSS@GMAIL.COM','0332623718');
INSERT INTO KHACHHANG VALUES('KH025','Ngô Châu Nh?','B16 Sonh Hành An Phú Q2','212234155','123S@GMAIL.COM','0442623718');
INSERT INTO KHACHHANG VALUES('KH026','Nguy?n ?ình Thu?n','57 ???ng 17A khu B an phú an khánh P.An Phú Q.02 TPHCM','231123755','90JSAD@GMAIL.COM','0552623718');
INSERT INTO KHACHHANG VALUES('KH027','Mai V?n Qu?nh','307 cao ?c an khánh song hành t? 42, An Phú Q.02 TPHCM','23128755','123455@GMAIL.COM','0662623718');
INSERT INTO KHACHHANG VALUES('KH028','H? Th? Thanh Nguyên','1080 ???ng 10B p. An Phú Q.02 TPHCM','231999755','123FXZ@GMAIL.COM','0772623718');

--PHIEUBAOHANH
INSERT INTO PHIEUBAOHANH VALUES('PBH01',TO_DATE('1/2/2019', 'dd/mm/yyyy'),	TO_DATE('3/5/2020', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH02',TO_DATE('5/6/2020', 'dd/mm/yyyy'),	TO_DATE('5/6/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH03',TO_DATE('13/5/2021', 'dd/mm/yyyy'),	TO_DATE('13/5/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH04',TO_DATE('4/2/2020', 'dd/mm/yyyy'),	TO_DATE('4/2/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH05',TO_DATE('12/2/2021', 'dd/mm/yyyy'),	TO_DATE('12/2/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH06',TO_DATE('13/9/2019', 'dd/mm/yyyy'),	TO_DATE('13/9/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH07',TO_DATE('25/1/2022', 'dd/mm/yyyy'),	TO_DATE('25/1/2023', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH08',TO_DATE('18/12/2019', 'dd/mm/yyyy'),	TO_DATE('18/12/2020', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH09',TO_DATE('19/11/2020', 'dd/mm/yyyy'),	TO_DATE('19/11/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH10',TO_DATE('20/10/2020', 'dd/mm/yyyy'),	TO_DATE('20/10/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH11',TO_DATE('21/9/2021', 'dd/mm/yyyy'),	TO_DATE('21/9/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH12',TO_DATE('11/8/2021', 'dd/mm/yyyy'),	TO_DATE('11/8/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH13',TO_DATE('12/7/2021', 'dd/mm/yyyy'),	TO_DATE('12/7/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH14',TO_DATE('30/6/2020', 'dd/mm/yyyy'),	TO_DATE('30/6/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH15',TO_DATE('30/5/2021', 'dd/mm/yyyy'),	TO_DATE('30/5/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH16',TO_DATE('12/5/2020', 'dd/mm/yyyy'),	TO_DATE('12/5/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH17',TO_DATE('19/4/2020', 'dd/mm/yyyy'),	TO_DATE('19/4/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH18',TO_DATE('22/3/2021', 'dd/mm/yyyy'),	TO_DATE('22/3/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH19',TO_DATE('10/4/2021', 'dd/mm/yyyy'),	TO_DATE('10/4/2022', 'dd/mm/yyyy'));
INSERT INTO PHIEUBAOHANH VALUES('PBH20',TO_DATE('9/6/2021', 'dd/mm/yyyy'),	TO_DATE('9/6/2022', 'dd/mm/yyyy'));

--NHANVIEN
INSERT INTO NHANVIEN VALUES('NV001','Nguy?n V?n S?n','NAM','231879755','47 TR?N BÌNH TR?NG, P.5, Q.BT, TP. HCM','vanson@GMAIL.COM','908010644',40,'PB001');
INSERT INTO NHANVIEN VALUES('NV002','Nguy?n thu th?y','N?','191879755','47-49 LÊ ANH XUÂN, P.BT, Q.1, TP. HCM','ntt@GMAIL.COM','908054768',40,'PB009');
INSERT INTO NHANVIEN VALUES('NV003','Nguy?n v?n an','NAM','271876655','35 NGUY?N HU? (HARBOUR VIEW TOWER PHÒNG 1105), P.BN, Q.1, TP. HCM','tva@GMAIL.COM','908121842',120,'PB008');
INSERT INTO NHANVIEN VALUES('NV004','Chu minh ??c','NAM','181879766','15 ??NG T?T, P.T?, Q.1, TP. HCM','cmd@GMAIL.COM','908173077',80,'PB001');
INSERT INTO NHANVIEN VALUES('NV005','Tr?n ??i ngh?a','NAM','221879534','225 PHÒNG M19-6 B?N CH??NG D??NG, P.CG, Q.1, TP. HCM','tdn@GMAIL.COM','908301339',70,'PB002');
INSERT INTO NHANVIEN VALUES('NV006','Lê ?ình long','NAM','223879752','41 NGUY?N TH??NG HI?N, P.5, Q.BT, TP. HCM','ldl@GMAIL.COM','908440093',30,'PB006');
INSERT INTO NHANVIEN VALUES('NV007','??ng minh tâm','N?','201879755','147 ?INH TIÊN HOÀNG, P.?K, Q.1, TP. HCM','dmt@GMAIL.COM','908511272',12,'PB002');
INSERT INTO NHANVIEN VALUES('NV008','Hà th? thu th?o','N?','231879755','275C PH?M NG? LÃO, P.PNL, Q.1, TP. HCM','httt@GMAIL.COM','908511272',18,'PB002');
INSERT INTO NHANVIEN VALUES('NV009','Nguy?n kh?c tr??ng','NAM','231879755','270 ?? THÁM, P.PNL, Q.1, TP. HCM','nkt@GMAIL.COM','908511272',10,'PB001');
INSERT INTO NHANVIEN VALUES('NV010','Tr?nh th? ng?','N?','221387975','335 NGUY?N THI?N THU?T, P.1, Q.3, TP. HCM','ttn@GMAIL.COM','908511272',20,'PB003');
INSERT INTO NHANVIEN VALUES('NV011','Chu Quy?t th?ng','NAM','231187975','207A TR?N TH? ??, P.PHÚ TH?NH, Q.TP, TP. HCM','cqt@GMAIL.COM','913600603',21,'PB003');
INSERT INTO NHANVIEN VALUES('NV012','Nguy?n th? bích th?o','N?','231879721','216 ?? THÁM, P.PNL, Q.1, TP. HCM','ntbt@GMAIL.COM','913173093',23,'PB004');
INSERT INTO NHANVIEN VALUES('NV013','Tr?n th? thu trang','N?','106278920','240 LÝ CHÍNH TH?NG, P.9, Q.3, TP. HCM','tttt@GMAIL.COM','913173066',25,'PB004');
INSERT INTO NHANVIEN VALUES('NV014','Ngô ki?u anh','N?','121879755','84 LÊ TH? H?NG G?M, P.NTB, Q.1, TP. HCM','nka@GMAIL.COM','913772689',56,'PB005');
INSERT INTO NHANVIEN VALUES('NV015','Lê ?ình long','NAM','341879755','28 HOÀNG HOA THÁM, P.7, Q.BT, TP. HCM','ldl@GMAIL.COM','913753328',66,'PB010');
INSERT INTO NHANVIEN VALUES('NV016','Ph?m gia long','NAM','121879728','112/2 TH?NG LONG, P.4, Q.TB, TP. HCM','pgl@GMAIL.COM','913830896',77,'PB007');
INSERT INTO NHANVIEN VALUES('NV017','V? qu?c c??ng','NAM','161879776','120B NGUY?N THANH TUY?N, P.2, Q.TB, TP. HCM','vqc@GMAIL.COM','913905377',12,'PB005');
INSERT INTO NHANVIEN VALUES('NV018','??ng nam m?','NAM','191879777','11/123 KP1 PH?M ??NG GI?N, P.BÌNH H?NG HÒA, Q.BTÂN, TP. HCM','dnm@GMAIL.COM','917199138',32,'PB002');
INSERT INTO NHANVIEN VALUES('NV019','Lê tr?ng hoàng','NAM','101879356','198 ???NG 10, P.4, Q.8, TP. HCM','lth@GMAIL.COM','918011228',12,'PB007');
INSERT INTO NHANVIEN VALUES('NV020','Nguy?n th? thúy an','N?','231879799','1007A THO?I NG?C H?U, P.HÒA TH?NH, Q.TP, TP. HCM','ntta@GMAIL.COM','918069598',16,'PB010');
INSERT INTO NHANVIEN VALUES('NV021','Tr?n thùy tâm','N?','121879755','515 LÊ H?NG PHONG, P.2, Q.10, TP. HCM','tttt2@GMAIL.COM','918190488',24,'PB008');
INSERT INTO NHANVIEN VALUES('NV022','V? kh?c th?nh','NAM','233219731','45/10 ÔNG ÍCH KHIÊM, P.10, Q.11, TP. HCM','vkt@GMAIL.COM','918295045',34,'PB004');
INSERT INTO NHANVIEN VALUES('NV023','Lê th? hi?n','N?','231879755','150 PHAN XÍCH LONG, P.2, Q.PN, TP. HCM','lth@GMAIL.COM','918333303',12,'PB005');
INSERT INTO NHANVIEN VALUES('NV024','Chu th? Hà','N?','231879755','20 QUANG TRUNG, P.10, Q.GV, TP. HCM','cth@GMAIL.COM','918449865',24,'PB005');
INSERT INTO NHANVIEN VALUES('NV025','?? khánh ngân','N?','231207556','157 NGUY?N H?NG ?ÀO, P.14, Q.TB, TP. HCM','dkn@GMAIL.COM','918531359',36,'PB003');
INSERT INTO NHANVIEN VALUES('NV026','Hoàng phi long','NAM','231854611','276 NGUY?N T?T THÀNH, P.13, Q.4, TP. HCM','hpl@GMAIL.COM','918586249',43,'PB006');
INSERT INTO NHANVIEN VALUES('NV027','Tr?n gia b?o','NAM','189879731','767 TR??NG CHINH, P.TÂY TH?NH, Q.TP, TP. HCM','tgb@GMAIL.COM','918818317',21,'PB009');
INSERT INTO NHANVIEN VALUES('NV028','Nguy?n gia phong','NAM','102318723','413/11 NGUY?N KI?M, P.9, Q.PN, TP. HCM','ngp@GMAIL.COM','933021321',12,'PB007');
INSERT INTO NHANVIEN VALUES('NV029','nguy?n ??t','NAM','212387975','V9 BA VÌ CX B?C H?I, P.15, Q.10, TP. HCM','nd@GMAIL.COM','933151313',34,'PB008');
INSERT INTO NHANVIEN VALUES('NV030','Nguy?n ??c thu?n','NAM','241879995','106 B?C H?I, P.6, Q.TB, TP. HCM','ndt@GMAIL.COM','937999120',45,'PB004');
INSERT INTO NHANVIEN VALUES('NV031','Hà danh tu?n','NAM','211873783','58/19 PH?M NG?C TH?CH, P.6, Q.3, TP. HCM','hdt@GMAIL.COM','938070069',45,'PB009');
INSERT INTO NHANVIEN VALUES('NV032','V? hoài lân','NAM','241597251','8 TR?T LÔ K CC BÀU CÁT 2, P.10, Q.TB, TP. HCM','vhl@GMAIL.COM','938301251',45,'PB009');
INSERT INTO NHANVIEN VALUES('NV033','Lê ??c tr?ng','NAM','245792755','116A NGÔ QUY?N, P.8, Q.5, TP. HCM','ldt@GMAIL.COM','938470202',45,'PB009');
INSERT INTO NHANVIEN VALUES('NV034','Nguy?n hùng d?ng','NAM','288797559','71/2/24 NGUY?N B?C, P.3, Q.TB, TP. HCM','nhd@GMAIL.COM','939838497',45,'PB010');
INSERT INTO NHANVIEN VALUES('NV035','V? th? khánh huy?n','N?','232387975','136/4C NGUY?N TRI PH??NG, P.9, Q.5, TP. HCM','vtkh@GMAIL.COM','982079054',45,'PB010');

--DANGNHAP
INSERT INTO DANGNHAP VALUES('quanly1','quan ly','ql1_123','NV002');
INSERT INTO DANGNHAP VALUES('quanly2','quan ly','ql2_123','NV031');
INSERT INTO DANGNHAP VALUES('quanly3','quan ly','ql3_123','NV032');
INSERT INTO DANGNHAP VALUES('quanly4','quan ly','ql4_123','NV033');
INSERT INTO DANGNHAP VALUES('quanly5','quan ly','ql5_123','NV027');
INSERT INTO DANGNHAP VALUES('nhanvien1','nhan vien','nv1_123','NV008');
INSERT INTO DANGNHAP VALUES('nhanvien2','nhan vien','nv2_123','NV015');
INSERT INTO DANGNHAP VALUES('nhanvien3','nhan vien','nv3_123','NV018');
INSERT INTO DANGNHAP VALUES('nhanvien4','nhan vien','nv4_123','NV022');
INSERT INTO DANGNHAP VALUES('nhanvien5','nhan vien','nv5_123','NV029');

--HOADON
INSERT INTO HD_BANSP VALUES('HD001','KH001','PBH01','NV001',TO_DATE('1/2/2019', 'dd/mm/yyyy'),1250000);
INSERT INTO HD_BANSP VALUES('HD002','KH002','PBH02','NV003',TO_DATE('5/6/2020', 'dd/mm/yyyy'),5780000);
INSERT INTO HD_BANSP VALUES('HD003','KH003','PBH03','NV006',TO_DATE('13/5/2021', 'dd/mm/yyyy'),5600000);
INSERT INTO HD_BANSP VALUES('HD004','KH004','PBH04','NV007',TO_DATE('4/2/2020', 'dd/mm/yyyy'),5525000);
INSERT INTO HD_BANSP VALUES('HD005','KH005','PBH05','NV008',TO_DATE('12/2/2021', 'dd/mm/yyyy'),5600000);
INSERT INTO HD_BANSP VALUES('HD006','KH006','PBH06','NV009',TO_DATE('13/9/2019', 'dd/mm/yyyy'),1250000);
INSERT INTO HD_BANSP VALUES('HD007','KH007','PBH07','NV003',TO_DATE('25/1/2022', 'dd/mm/yyyy'),2890000);
INSERT INTO HD_BANSP VALUES('HD008','KH008','PBH08','NV002',TO_DATE('18/12/2019', 'dd/mm/yyyy'),2800000);
INSERT INTO HD_BANSP VALUES('HD009','KH009','PBH09','NV001',TO_DATE('19/11/2020', 'dd/mm/yyyy'),11050000);
INSERT INTO HD_BANSP VALUES('HD010','KH010','PBH10','NV004',TO_DATE('20/10/2020', 'dd/mm/yyyy'),2800000);
INSERT INTO HD_BANSP VALUES('HD011','KH011','PBH11','NV001',TO_DATE('21/9/2021', 'dd/mm/yyyy'),2720000);
INSERT INTO HD_BANSP VALUES('HD012','KH012','PBH12','NV003',TO_DATE('11/8/2021', 'dd/mm/yyyy'),16490000);
INSERT INTO HD_BANSP VALUES('HD013','KH013','PBH13','NV009',TO_DATE('12/7/2021', 'dd/mm/yyyy'),10346000);
INSERT INTO HD_BANSP VALUES('HD014','KH014','PBH14','NV008',TO_DATE('30/6/2020', 'dd/mm/yyyy'),8240000);
INSERT INTO HD_BANSP VALUES('HD015','KH015','PBH15','NV006',TO_DATE('30/5/2021', 'dd/mm/yyyy'),16065000);
INSERT INTO HD_BANSP VALUES('HD016','KH016','PBH16','NV001',TO_DATE('12/5/2020', 'dd/mm/yyyy'),8000000);
INSERT INTO HD_BANSP VALUES('HD017','KH017','PBH17','NV003',TO_DATE('19/4/2020', 'dd/mm/yyyy'),17850000);
INSERT INTO HD_BANSP VALUES('HD018','KH018','PBH18','NV002',TO_DATE('22/3/2021', 'dd/mm/yyyy'),45900000);
INSERT INTO HD_BANSP VALUES('HD019','KH019','PBH19','NV005',TO_DATE('10/4/2021', 'dd/mm/yyyy'),26200000);
INSERT INTO HD_BANSP VALUES('HD020','KH020','PBH20','NV006',TO_DATE('9/6/2021', 'dd/mm/yyyy'),7400000);

--CTHD
INSERT INTO CTHD_BANSP VALUES('HD001','SP001',1);
INSERT INTO CTHD_BANSP VALUES('HD002','SP002',2);
INSERT INTO CTHD_BANSP VALUES('HD003','SP003',2);
INSERT INTO CTHD_BANSP VALUES('HD004','SP004',1);
INSERT INTO CTHD_BANSP VALUES('HD005','SP005',2);
INSERT INTO CTHD_BANSP VALUES('HD006','SP001',1);
INSERT INTO CTHD_BANSP VALUES('HD007','SP002',1);
INSERT INTO CTHD_BANSP VALUES('HD008','SP003',1);
INSERT INTO CTHD_BANSP VALUES('HD009','SP004',2);
INSERT INTO CTHD_BANSP VALUES('HD010','SP005',1);
INSERT INTO CTHD_BANSP VALUES('HD011','SP006',1);
INSERT INTO CTHD_BANSP VALUES('HD012','SP007',2);
INSERT INTO CTHD_BANSP VALUES('HD013','SP009',2);
INSERT INTO CTHD_BANSP VALUES('HD014','SP008',1);
INSERT INTO CTHD_BANSP VALUES('HD015','SP010',2);
INSERT INTO CTHD_BANSP VALUES('HD016','SP011',1);
INSERT INTO CTHD_BANSP VALUES('HD017','SP012',3);
INSERT INTO CTHD_BANSP VALUES('HD018','SP014',3);
INSERT INTO CTHD_BANSP VALUES('HD019','SP013',5);
INSERT INTO CTHD_BANSP VALUES('HD020','SP015',2);



-------DANH SACH CAC PROCEDURE


--PRO1: THEM NHA CUNG CAP
create or replace PROCEDURE them_nhacungcap( ma_ncc nhacungcap.mancc%type, ten_ncc nhacungcap.tenncc%type, dia_chi nhacungcap.diachi%type, email_ncc  nhacungcap.email%type,
sdt_ncc nhacungcap.sdt%type)
as
sname nhacungcap.mancc%type;
begin
select mancc into sname
from nhacungcap
where ma_ncc=mancc;
DBMS_OUTPUT.PUT_LINE('da ton tai nha cung cap co ma :'||sname);
EXCEPTION WHEN NO_DATA_FOUND THEN
insert into nhacungcap(mancc,tenncc,diachi,email,sdt)  values  (ma_ncc,ten_ncc,dia_chi,email_ncc,sdt_ncc);
DBMS_OUTPUT.PUT_LINE('Them thanh cong');
end;

--PRO2: TRA CUU NHA CUNG CAP
CREATE OR REPLACE PROCEDURE tracuu_nhacungcap( ma_ncc NHACUNGCAP.MANCC%TYPE)
as
sname varchar2(300);
begin
select mancc||', '||tenncc||', '||diachi||', '||email||', '||sdt into sname
from nhacungcap
where ma_ncc=mancc;
DBMS_OUTPUT.PUT_LINE(sname);
EXCEPTION 
        WHEN NO_DATA_FOUND THEN
            DBMS_OUTPUT.PUT_LINE('KHONG TON TAI NHA CUNG CAP NAY');
end;

--PRO3: XOA NHA CUNG CAP
CREATE OR REPLACE PROCEDURE xoa_nhacungcap( ma_ncc NHACUNGCAP.MANCC%TYPE)
as
begin
delete from nhacungcap
where mancc=ma_ncc;
EXCEPTION 
        WHEN NO_DATA_FOUND THEN
            DBMS_OUTPUT.PUT_LINE('KHONG TON TAI NHA CUNG CAP NAY');
end;

--PRO4: CAP NHAT NHA CUNG CAP
create or replace PROCEDURE capnhat_nhacungcap( ma_ncc nhacungcap.mancc%type, ten_ncc nhacungcap.tenncc%type, dia_chi nhacungcap.diachi%type, email_ncc  nhacungcap.email%type,
sdt_ncc nhacungcap.sdt%type)
as
begin
update nhacungcap
set tenncc=ten_ncc,diachi=dia_chi,email=email_ncc,sdt=sdt_ncc
where mancc=ma_ncc;
DBMS_OUTPUT.PUT_LINE('cap nhat thanh cong ');
end;

--PRO4: THEM KHUYEN MAI
create or replace PROCEDURE them_khuyenmai( ma_km KHUYENMAI.MAKM%TYPE, ten_km khuyenmai.tenkm%type, ngay_bd khuyenmai.ngaybd%type, ngay_kt khuyenmai.ngaykt%type,
phantram khuyenmai.phantramkm%type)
as
sname khuyenmai.makm%type;
begin
select makm into sname
from khuyenmai
where ma_km=makm;
DBMS_OUTPUT.PUT_LINE('da ton tai khuyen mai co ma :'||sname);
EXCEPTION WHEN NO_DATA_FOUND THEN
insert into khuyenmai(makm,tenkm,ngaybd,ngaykt,phantramkm)  values  (ma_km,ten_km,ngay_bd,ngay_kt,phantram);
DBMS_OUTPUT.PUT_LINE('Them thanh cong');
end;

--PRO5: TRA CUU KHUYEN MAI
CREATE OR REPLACE PROCEDURE tracuu_khuyenmai( ma_km KHUYENMAI.MAKM%TYPE)
as
sname varchar2(300);
begin
select MAKM||', '||TENKM||', '||NGAYBD||'-'||NGAYKT||', '||PHANTRAMKM into sname
from nhacungcap
where ma_km=MAKM;
DBMS_OUTPUT.PUT_LINE(sname);
EXCEPTION 
        WHEN NO_DATA_FOUND THEN
            DBMS_OUTPUT.PUT_LINE('KHONG TON TAI KHUYEN MAI NAY');
end;

--PRO6: XOA KHUYEN MAI
CREATE OR REPLACE PROCEDURE xoa_khuyenmai( ma_km KHUYENMAI.MAKM%TYPE)
as
begin
delete from khuyenmai
where MAKM=ma_km;
EXCEPTION 
        WHEN NO_DATA_FOUND THEN
            DBMS_OUTPUT.PUT_LINE('KHONG TON TAI khuyenmai NAY');
end; 

--PRO7: CAP NHAT KHUYEN MAI
create or replace PROCEDURE capnhat_khuyenmai( ma_km KHUYENMAI.MAKM%TYPE, ten_km khuyenmai.tenkm%type, ngay_bd khuyenmai.ngaybd%type, ngay_kt khuyenmai.ngaykt%type,
phantram khuyenmai.phantramkm%type)
as
begin
update khuyenmai
set tenkm=ten_km, ngaybd=ngay_bd,ngaykt=ngay_kt,phantramkm=phantram
where ma_km=makm;
DBMS_OUTPUT.PUT_LINE('cap nhat thanh cong ');
end;

--PRO8: THEM BAO HANH
create or replace PROCEDURE them_baohanh( ma_bh baohanhsp.mabh%TYPE, ma_sp baohanhsp.masp%type, ngay_bh baohanhsp.ngaybh%type, chiphi_bh baohanhsp.chiphibh%type,
mota_loi baohanhsp.motaloi%type)
as
sname baohanhsp.mabh%type;
begin
select mabh into sname
from baohanhsp
where ma_bh=mabh;
DBMS_OUTPUT.PUT_LINE('da ton tai bao hanh co ma :'||sname);
EXCEPTION WHEN NO_DATA_FOUND THEN
insert into baohanhsp(mabh,masp,ngaybh,chiphibh,motaloi)  values  (ma_bh,ma_sp,ngay_bh,chiphi_bh,mota_loi);
DBMS_OUTPUT.PUT_LINE('Them thanh cong');
end;

--PRO9:TRA CUU BAO HANH
CREATE OR REPLACE PROCEDURE tracuu_baohanh( ma_bh BAOHANHSP.MABH%TYPE)
as
sname varchar2(300);
begin
select MABH||', '||MASP||', '||NGAYBH||', '||CHIPHIBH||', '||MOTALOI into sname
from baohanhsp
where ma_bh=MABH;
DBMS_OUTPUT.PUT_LINE(sname);
EXCEPTION 
        WHEN NO_DATA_FOUND THEN
            DBMS_OUTPUT.PUT_LINE('KHONG TON TAI BAO HANH NAY');
end;

--PRO10: XOA BAO HANH:
CREATE OR REPLACE PROCEDURE xoa_baohanh( ma_bh BAOHANHSP.MABH%TYPE)
as
begin
delete from baohanhsp
where ma_bh=MABH;
EXCEPTION 
        WHEN NO_DATA_FOUND THEN
            DBMS_OUTPUT.PUT_LINE('KHONG TON TAI BAO HANH NAY');
end;

--PRO11: CAP NHAT BAO HANH
create or replace PROCEDURE capnhat_baohanh( ma_bh baohanhsp.mabh%TYPE, ma_sp baohanhsp.masp%type, ngay_bh baohanhsp.ngaybh%type, chiphi_bh baohanhsp.chiphibh%type,
mota_loi baohanhsp.motaloi%type)
as
begin
update baohanhsp
set masp=ma_sp, ngaybh=ngay_bh,chiphibh=chiphi_bh,motaloi=mota_loi
where ma_bh=mabh;
DBMS_OUTPUT.PUT_LINE('cap nhat thanh cong ');
end;

--PRO12: THEM SAN PHAM
CREATE OR REPLACE PROCEDURE them_sanpham(ma_sp SANPHAM.MaSP%TYPE,ma_km KHUYENMAI.MaKM%TYPE,
                                            ma_ncc NHACUNGCAP.MANCC%TYPE,tensp SANPHAM.TenSP%TYPE,
                                            mausac SANPHAM.MAUSAC%TYPE,dongia SANPHAM.DonGia%TYPE,
                                            soluong SANPHAM.SoLuong%TYPE)
AS
    masanpham SANPHAM.MaSP%TYPE := NULL;
    TONGSLSP NUMBER;
BEGIN
    SELECT MaSP INTO masanpham
    FROM SANPHAM
    WHERE MaSP=ma_sp;
    BEGIN
        TONGSLSP:=tongsanpham;
    END;
    IF (masanpham IS NOT NULL) THEN
        DBMS_OUTPUT.PUT_LINE('Ma san pham da ton tai, vui long nhap lai');
    ELSIF (TONGSLSP >=300) THEN
        DBMS_OUTPUT.PUT_LINE('Tong san pham da day, khong the them san pham');
    END IF;
    EXCEPTION
    WHEN NO_DATA_FOUND THEN
        INSERT INTO SANPHAM (MaSP,MaKM,MaNCC,TenSP,MauSac,DonGia,SoLuong) 
        VALUES (ma_sp,ma_km,ma_ncc,tensp,mausac,dongia,soluong);
        DBMS_OUTPUT.PUT_LINE('Them thanh cong');
END;

--PRO13: XOA SAN PHAM
CREATE OR REPLACE PROCEDURE xoa_sanpham(ma_sp SANPHAM.MaSP%TYPE)
AS
BEGIN
    DELETE FROM SANPHAM WHERE MaSP=ma_sp;
    EXCEPTION
    WHEN NO_DATA_FOUND THEN 
        DBMS_OUTPUT.PUT_LINE('Xoá khong thanh cong');
END;

--PRO14: TRA CUU SAN PHAM
CREATE OR REPLACE PROCEDURE tracuu_sanpham(ma_sp SANPHAM.MaSP%TYPE)
as
sname varchar2(300);
begin
select MaSP || ' ' ||MaKM || ' ' ||MaNCC || ' ' ||TenSP || ' ' ||MauSac || ' ' ||DonGia || ' ' || SoLuong into sname
from sanpham
where MaSP=ma_sp;
DBMS_OUTPUT.PUT_LINE(sname);
EXCEPTION 
        WHEN NO_DATA_FOUND THEN
            DBMS_OUTPUT.PUT_LINE('KHONG TON TAI SAN PHAM NAY');
end;

--PRO15: CAP NHAT SAN PHAM
create or replace PROCEDURE capnhat_baohanh( ma_sp SANPHAM.MaSP%TYPE,ma_km KHUYENMAI.MaKM%TYPE,
                                            ma_ncc NHACUNGCAP.MANCC%TYPE,tensp SANPHAM.TenSP%TYPE,
                                            mausac SANPHAM.MAUSAC%TYPE,dongia SANPHAM.DonGia%TYPE,
                                            soluong SANPHAM.SoLuong%TYPE)
as
begin
update SANPHAM
set Masp=ma_sp,MaKM=ma_km,MaNCC=ma_ncc,TenSP=tensp,MauSac=mausac,DonGia=dongia,SoLuong=soluong
where MaSP=ma_sp;
DBMS_OUTPUT.PUT_LINE('cap nhat thanh cong ');
end;

--PRO16: Doanh thu ban hang trong thang
CREATE OR REPLACE PROCEDURE doanhthu_thang(thang NUMBER,nam NUMBER)
AS 
    doanhthu NUMBER;
BEGIN
    SELECT SUM(TriGia) INTO doanhthu
    FROM HD_BANSP
    WHERE EXTRACT(YEAR FROM NgayLapHD)= nam and EXTRACT(MONTH FROM NgayLapHD)=thang;
    DBMS_OUTPUT.PUT_LINE('Doanh thu cua thang '||thang||',nam '||nam||' : '||doanhthu);
    EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('Tinh doanh thu khong thanh cong');
END;

--PRO17: Cap nhat tri gia cua hoá don khi thay doi don gia cua san pham
CREATE OR REPLACE PROCEDURE update_trigia(ma_sp SANPHAM.MaSP%TYPE)
AS
    so_hd HD_BANSP.SoHD%TYPE;
    DONGIA SANPHAM.DonGia%TYPE;
    SL CTHD_BANSP.SoLuongMua%TYPE;
    ma_km KHUYENMAI.MaKM%TYPE;
    ptkm KHUYENMAI.PhanTramKM%TYPE;
BEGIN
    SELECT CT.SoHD, SP.DonGia,CT.SoLuongMua,SP.MaKM INTO so_hd,DONGIA,SL,ma_km
    FROM SANPHAM SP JOIN CTHD_BANSP CT ON SP.MaSP=CT.MaSP
    WHERE SP.MaSP=ma_sp;
    SELECT PhanTramKM INTO ptkm
    FROM SANPHAM SP JOIN KHUYENMAI KM ON SP.MaKM=KM.MaKM
    WHERE SP.MaKM=ma_km;
    UPDATE HD_BANSP SET TriGia=((DONGIA*SL)-(DONGIA*ptkm/100)*SL) WHERE SoHD=so_hd;
END;

--PRO18: Hien thi so hoa don ban hang trong thang
CREATE OR REPLACE PROCEDURE sohoadon_thang(thang NUMBER,nam NUMBER)
AS 
    sohoadon NUMBER;
BEGIN
    SELECT COUNT(SoHD) INTO sohoadon
    FROM HD_BANSP
    WHERE EXTRACT(YEAR FROM NgayLapHD)= nam and EXTRACT(MONTH FROM NgayLapHD)=thang;
    DBMS_OUTPUT.PUT_LINE('So hoa don cua thang '||thang||',nam '||nam||' : '||sohoadon);
    EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('Khong co du lieu');
END;

--PRO19: Hien thi so hoa don khach hang do mua trong nam
CREATE OR REPLACE PROCEDURE soHDKH_nam(ma_KH HD_BANSP.MAKH%TYPE,nam NUMBER)
AS
    sohoadon NUMBER;
BEGIN
    SELECT COUNT(SoHD) INTO sohoadon
    FROM HD_BANSP
    WHERE EXTRACT(YEAR FROM NgayLapHD)= nam AND MaKH = ma_KH
    GROUP BY MAKH;
    DBMS_OUTPUT.PUT_LINE('So hoa don cua khach hang ' || ma_KH|| ' trong nam '||nam||' : '||sohoadon);
    EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('Khong co du lieu');
END;

-------------------------DANH SACH FUNCTION


--FUN1: Tinh tong san pham
CREATE OR REPLACE FUNCTION tongsanpham
RETURN NUMBER
AS
    TONGKHO NUMBER;
BEGIN
    SELECT SUM(SoLuong) INTO TONGKHO
    FROM SANPHAM;
    RETURN TONGKHO;
    EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('Tinh tong khong thanh cong');
END;

--FUN2: Tinh luong nhan vien
CREATE OR REPLACE FUNCTION tinhluongNV(ma_nv NHANVIEN.MaNV%TYPE,mucluong NUMBER)
RETURN NUMBER
AS
    luong NUMBER;
    snlv NHANVIEN.SoNgayLam%TYPE;
BEGIN
    SELECT SoNgayLam INTO snlv
    FROM NHANVIEN
    WHERE MaNV=ma_nv;
    luong:=snlv*mucluong;
    RETURN luong;
    EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('Tinh tong khong thanh cong');
END;

--FUN3: Doanh thu ban hang trong nam
CREATE OR REPLACE FUNCTION doanhthu_nam(nam NUMBER)
RETURN NUMBER
AS
    DOANHTHU NUMBER;
BEGIN
    SELECT SUM(TRIGIA) INTO DOANHTHU
    FROM HD_BANSP
    WHERE EXTRACT(YEAR FROM NgayLapHD)= nam;
    RETURN DOANHTHU;
    EXCEPTION
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('Tinh doanh thu khong thanh cong');
END;


--------------DANH SACH TRIGGER


---TRIG1: Kiem tra và cap nhat so luong nhân viên khi them 1 nhan vien
CREATE OR REPLACE TRIGGER check_update_soluongNV_forinsert
BEFORE INSERT ON NHANVIEN
FOR EACH ROW
DECLARE
    slnv PHONGBAN.SoLuongNV%TYPE;
BEGIN
    SELECT COUNT(MaNV) INTO slnv
    FROM NHANVIEN
    WHERE MaPB=:NEW.MaPB
    GROUP BY :NEW.MaPB;
    IF ((10-slnv)<1) THEN
        RAISE_APPLICATION_ERROR(-20000,'So luong nhan vien da day');
    ELSE
        DBMS_OUTPUT.PUT_LINE('Them nhan vien thanh cong');
        UPDATE PHONGBAN SET SoLuongNV=SoLuongNV+1 WHERE MaPB=:NEW.MaPB;
    END IF;
END;


---TRIG2: Kiem tra va cap nhat so luong nhan vien khi xoa 1 nhan vien
CREATE OR REPLACE TRIGGER check_update_soluongNV_fordelete
AFTER DELETE ON NHANVIEN
FOR EACH ROW
DECLARE
    slnv PHONGBAN.SoLuongNV%TYPE;
BEGIN
    SELECT COUNT(MaNV) INTO slnv
    FROM NHANVIEN
    WHERE MaPB=:OLD.MaPB
    GROUP BY :OLD.MaPB;
    IF (slnv<1) THEN
        UPDATE PHONGBAN SET SoLuongNV=0 WHERE MaPB=:OLD.MaPB;
        DBMS_OUTPUT.PUT_LINE('Da xoa nhan vien cuoi cung cua phong ban');
    ELSE
        UPDATE PHONGBAN SET SoLuongNV=SoLuongNV-1 WHERE MaPB=:OLD.MaPB;
    END IF;
END;


--TRIG3: Kiem tra them khuyen mai
CREATE OR REPLACE TRIGGER check_ngkm
BEFORE INSERT ON KHUYENMAI
FOR EACH ROW
DECLARE
BEGIN
    IF TO_DATE(:NEW.NgayKT,'dd/mm/yyyy') < TO_DATE(:NEW.NgayBD,'dd/mm/yyyy') THEN
        RAISE_APPLICATION_ERROR(-20000,'Ngay ket thuc khong hop le,vui long nhap lai');
    ELSE
        DBMS_OUTPUT.PUT_LINE('Nhap ngay ket thuc thanh cong');
    END IF;
END;


--TRIG4: Kiem tra cap nhat ngay khuyen mai
CREATE OR REPLACE TRIGGER check_update_ngkm
BEFORE UPDATE ON KHUYENMAI
FOR EACH ROW
DECLARE
BEGIN
    IF TO_DATE(:NEW.NgayKT,'dd/mm/yyyy') < TO_DATE(:NEW.NgayBD,'dd/mm/yyyy') THEN
        RAISE_APPLICATION_ERROR(-20000,'Ngay ket thuc khong hop le,vui long nhap lai');
    ELSE
        DBMS_OUTPUT.PUT_LINE('Nhap ngay ket thuc thanh cong');
    END IF;
END;


--TRIG5: Kiem tra them bao hanh
CREATE OR REPLACE TRIGGER check_ngbh
BEFORE INSERT ON PHIEUBAOHANH
FOR EACH ROW
DECLARE
BEGIN
    IF TO_DATE(:NEW.NgayHetHan,'dd/mm/yyyy') < TO_DATE(:NEW.NgayBatDau,'dd/mm/yyyy') THEN
        RAISE_APPLICATION_ERROR(-20000,'Ngay ket thuc khong hop le,vui long nhap lai');
    ELSE
        DBMS_OUTPUT.PUT_LINE('Nhap ngay ket thuc thanh cong');
    END IF;
END;



---TRIG6: Kiem tra cap nhat bao hanh
CREATE OR REPLACE TRIGGER check_update_ngbh
BEFORE UPDATE ON PHIEUBAOHANH
FOR EACH ROW
DECLARE
BEGIN
    IF TO_DATE(:NEW.NgayHetHan,'dd/mm/yyyy') < TO_DATE(:NEW.NgayBatDau,'dd/mm/yyyy') THEN
        RAISE_APPLICATION_ERROR(-20000,'Ngay ket thuc khong hop le,vui long nhap lai');
    ELSE
        DBMS_OUTPUT.PUT_LINE('Nhap ngay ket thuc thanh cong');
    END IF;
END;


--TRIG7: Them 1 hoa don phai co it nhat 1 so hoa don trong chi tiet hoa don
CREATE OR REPLACE TRIGGER them_hd
BEFORE INSERT ON HD_BANSP
FOR EACH ROW
DECLARE 
    so_hd HD_BANSP.SoHD%TYPE;
BEGIN
    so_hd:=:NEW.SoHD;
    INSERT INTO CTHD_BANSP VALUES(so_hd,'NONE',0);
    DBMS_OUTPUT.PUT_LINE('Them thanh cong, can update lai cthd(masp,soluongmua)');
END;

---TRIG8: Xoa hoa don cuoi cung o chi tiet hoa don thi xoa hoa don do o hoa don
CREATE OR REPLACE TRIGGER xoa_cthd
AFTER DELETE ON CTHD_BANSP
FOR EACH ROW
DECLARE
   SOLUONG NUMBER;
   so_hd CTHD_BANSP.SoHD%TYPE;
BEGIN
    so_hd:=:OLD.SOHD;
    SELECT COUNT(so_hd) INTO soluong
    FROM CTHD_BANSP CT
    WHERE CT.SoHD=so_hd
    GROUP BY so_hd;
    IF(soluong <1) THEN
        DELETE FROM HD_BANSP WHERE SoHD=so_hd;
        DBMS_OUTPUT.PUT_LINE('Xoa cthd cuoi cung cua hoa don tren');
    END IF;
END;
